<div class="teacher-dashboard-layout">

  <!-- âœ… Top Right Logout -->
  <div class="top-nav">
    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-overlay">
      <div class="spinner"></div>
      <p>Loading dashboard data...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
      <button (click)="loadDashboardData(currentClassId || undefined)">Retry</button>
    </div>

    <div *ngIf="!isLoading && !errorMessage">
      <!-- âœ… Overview -->
      <div *ngIf="currentView === 'overview'">
        <div class="dashboard-header">
          <h1>{{ subjectName }} Dashboard <span *ngIf="currentClass">({{ currentClass.name }})</span></h1>
          <p>Welcome, {{ teacherName }} (Subject Teacher)</p>
        </div>

        <div class="kpi-section" *ngIf="currentClass; else noClassSelected">
          <div class="kpi-card">
            <h3>Total Students</h3>
            <p>{{ totalStudents }}</p>
          </div>
          <div class="kpi-card">
            <h3>Pending Assignments</h3>
            <p>{{ pendingAssignments }}</p>
          </div>
          <div class="kpi-card">
            <h3>Class Average</h3>
            <p>{{ averageMarks }}%</p>
          </div>
        </div>

        <ng-template #noClassSelected>
          <div class="empty-state">
            <h3>Please select a class from the sidebar to view details.</h3>
          </div>
        </ng-template>
      </div>

      <!-- ðŸ‘‰ My Profile View -->
      <div *ngIf="currentView === 'profile'" class="profile-panel">
        <h2>ðŸ‘¤ My Profile</h2>

        <div class="profile-row"><strong>Name:</strong> {{ teacherProfile.name }}</div>
        <div class="profile-row"><strong>Email:</strong> {{ teacherProfile.email }}</div>
        <div class="profile-row"><strong>Role:</strong> {{ teacherProfile.role }}</div>
        <div class="profile-row"><strong>Subject:</strong> {{ subjectName }}</div>

        <div *ngIf="teacherProfile.className">
          <div class="profile-row"><strong>Class Teacher of:</strong> {{ teacherProfile.className }}{{
            teacherProfile.division }}</div>
        </div>
      </div>

      <!-- âœ… Marks Entry -->
      <div *ngIf="currentView === 'marks'">
        <div class="exam-overview-panel">

          <h2>Exam Marks Entry <span *ngIf="currentClass">({{ currentClass.name }})</span></h2>

          <div class="exam-filter">
            <label>Select Exam Type:</label>

            <div class="exam-dropdown" [class.open]="isDropdownOpen" (click)="toggleDropdown()">
              <div class="selected-exam">
                <span class="exam-tag">{{ selectedExam }}</span>
                <span class="arrow" [class.open]="isDropdownOpen">&#9662;</span>
              </div>

              <ul class="exam-options" *ngIf="isDropdownOpen">
                <li *ngFor="let exam of examTypes" [class.active]="exam === selectedExam" (click)="selectExam(exam)">
                  {{ exam }}
                </li>
              </ul>
            </div>
          </div>

          <div *ngIf="currentClass; else selectClassMsg">
            <table class="exam-table" *ngIf="students.length > 0; else noStudentsMsg">
              <thead>
                <tr>
                  <th>Roll No</th>
                  <th>Name</th>
                  <th>{{ selectedExam }} Marks (Out of 100)</th>
                  <th>Action</th>
                </tr>
              </thead>

              <tbody>
                <tr *ngFor="let s of students">
                  <td>{{ s.rollNo }}</td>
                  <td>{{ s.name }}</td>

                  <td>
                    <input type="number" class="marks-input" [(ngModel)]="s.examMarks" min="0" max="100"
                      placeholder="Enter marks">
                  </td>

                  <td>
                    <button class="approve-btn" (click)="updateMarks(s)">Save</button>
                  </td>
                </tr>
              </tbody>
            </table>

            <ng-template #noStudentsMsg>
              <div class="empty-state">
                <p>No students found in this class.</p>
              </div>
            </ng-template>
          </div>

          <ng-template #selectClassMsg>
            <div class="empty-state">
              <p>Please select a class to enter marks.</p>
            </div>
          </ng-template>

        </div>
      </div>

      <!-- âœ… Assignments -->
      <div *ngIf="currentView === 'assignments'">
        <div class="event-management-panel">

          <h2>Assignments <span *ngIf="currentClass">({{ currentClass.name }})</span></h2>

          <div *ngIf="currentClass; else selectClassAssign">
            <div class="attendance-controls">
              <input type="text" [(ngModel)]="newAssignment.title" placeholder="Assignment Title">
              <input type="date" [(ngModel)]="newAssignment.dueDate">
              <input type="url" [(ngModel)]="newAssignment.link" placeholder="Resource Link (optional)">
              <input type="text" [(ngModel)]="newAssignment.description" placeholder="Description...">
              <button (click)="addAssignment()">Add Assignment</button>
            </div>

            <div class="empty-state">
              <p>Assignment management feature is coming soon!</p>
              <p>Currently assignments are stored locally and will be reset on refresh.</p>
            </div>

            <table class="leave-table" *ngIf="assignments.length > 0">
              <thead>
                <tr>
                  <th>Title</th>
                  <th>Due Date</th>
                  <th>Link</th>
                  <th>Description</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>

              <tbody>
                <tr *ngFor="let a of assignments">
                  <td>{{ a.title }}</td>
                  <td>{{ a.dueDate | date }}</td>
                  <td>
                    <a *ngIf="a.link" [href]="a.link" target="_blank" class="resource-link">
                      ðŸ”— Open Link
                    </a>
                    <span *ngIf="!a.link" class="no-link">No link</span>
                  </td>
                  <td>{{ a.description }}</td>
                  <td>{{ a.status }}</td>

                  <td>
                    <button class="approve-btn" (click)="editAssignment(a)">Edit</button>
                    <button class="reject-btn" (click)="deleteAssignment(a)">Delete</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <ng-template #selectClassAssign>
            <div class="empty-state">
              <p>Please select a class to manage assignments.</p>
            </div>
          </ng-template>

        </div>
      </div>

      <!-- âœ… Resources -->
      <div *ngIf="currentView === 'resources'">
        <div class="student-roster">

          <h2>Teaching Resources <span *ngIf="currentClass">({{ currentClass.name }})</span></h2>

          <div *ngIf="currentClass; else selectClassRes">
            <div class="attendance-controls">
              <input type="text" [(ngModel)]="newResource.title" placeholder="Resource Title">
              <input type="url" [(ngModel)]="newResource.link" placeholder="Resource Link">
              <button (click)="addResource()">Add Resource</button>
            </div>

            <div class="empty-state">
              <p>Resource management feature is coming soon!</p>
              <p>Currently resources are stored locally and will be reset on refresh.</p>
            </div>

            <table class="leave-table" *ngIf="resources.length > 0">
              <thead>
                <tr>
                  <th>Title</th>
                  <th>Link</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let r of resources">
                  <td>{{ r.title }}</td>
                  <td><a [href]="r.link" target="_blank">{{ r.link }}</a></td>
                </tr>
              </tbody>
            </table>
          </div>

          <ng-template #selectClassRes>
            <div class="empty-state">
              <p>Please select a class to manage resources.</p>
            </div>
          </ng-template>

        </div>
      </div>
    </div>

  </div>
</div>