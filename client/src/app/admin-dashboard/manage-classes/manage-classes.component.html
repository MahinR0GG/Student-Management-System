<div class="manage-classes">

  <h2 class="title">üè´ Manage Classes</h2>

  <!-- üîç Search + Add -->
  <div class="filter-bar">
    <input type="text" [(ngModel)]="searchTerm" placeholder="Search by class or teacher..." class="search-box" />
    <button class="add-btn" (click)="openAddModal()">‚ûï Add Class</button>
  </div>

  <!-- üìã Table -->
  <div class="table-wrapper" *ngIf="filteredClasses.length > 0; else noData">
    <table class="class-table">
      <thead>
        <tr>
          <th>#</th>
          <th>Class</th>
          <th>Class Teacher</th>
          <th>Teacher's Subject</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let c of filteredClasses; let i = index">
          <td>{{ i + 1 }}</td>
          <td>{{ c.class_number || c.classNumber }}{{ c.division }}</td>
          <td>{{ c.class_teacher_name || c.classTeacher || '-' }}</td>
          <td>{{ getTeacherSubject(c.class_teacher || c.classTeacherId) || '-' }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <ng-template #noData>
    <p class="empty">No classes yet üòï</p>
  </ng-template>

  <!-- ‚úÖ ADD CLASS MODAL -->
  <div class="modal-backdrop" *ngIf="showAddModal">
    <div class="modal">
      <div class="modal-header">
        <h3>Add New Class</h3>
        <button class="close-btn" (click)="closeModal()">‚úñ</button>
      </div>

      <form (ngSubmit)="createClass()" class="modal-body">

        <!-- ‚úÖ CLASS NUMBER -->
        <div class="form-group">
          <label>Class Number</label>
          <select [(ngModel)]="newClass.classNumber" name="classNumber" required>
            <option [ngValue]="null" disabled>Select Class</option>
            <option [ngValue]="8">8</option>
            <option [ngValue]="9">9</option>
            <option [ngValue]="10">10</option>
          </select>
        </div>

        <!-- ‚úÖ DIVISION -->
        <div class="form-group">
          <label>Division</label>
          <select [(ngModel)]="newClass.division" name="division" required>
            <option [ngValue]="''" disabled>Select Division</option>
            <option [ngValue]="'A'">A</option>
            <option [ngValue]="'B'">B</option>
            <option [ngValue]="'C'">C</option>
          </select>
        </div>

        <!-- ‚úÖ CLASS TEACHER -->
        <div class="form-group">
          <label>Class Teacher</label>
          <select [(ngModel)]="newClass.classTeacherId" name="classTeacherId" required>
            <option [ngValue]="null" disabled>Select Teacher</option>
            <option *ngFor="let t of teachers" [ngValue]="t.id">
              {{ t.name }} ({{ t.subject }})
            </option>
          </select>
        </div>

        <!-- ‚úÖ SUBJECT TEACHERS -->
        <div class="subject-section">
          <h4>Subject Teachers</h4>

          <div *ngFor="let sub of subjectList" class="form-group">
            <label>{{ sub }}</label>

            <select [(ngModel)]="newClass.subjectTeachers[sub]" [name]="'sub_' + sub">
              <option [ngValue]="null">Select Teacher</option>

              <option *ngFor="let t of getTeachersBySubject(sub)" [ngValue]="t.id">
                {{ t.name }}
              </option>
            </select>
          </div>
        </div>

        <div class="modal-actions">
          <button type="button" class="cancel-btn" (click)="closeModal()">Cancel</button>
          <button type="submit" class="create-btn">Create Class</button>
        </div>

      </form>
    </div>
  </div>

</div>